#!/bin/bash
set -e

if ! getent passwd hlabmonitor > /dev/null; then
    adduser --system --group --home /var/lib/hlabmonitor \
            --no-create-home --disabled-password \
            --gecos "HLabMonitor service user" hlabmonitor
fi

chown -R hlabmonitor:hlabmonitor /var/lib/hlabmonitor
chown -R hlabmonitor:hlabmonitor /var/log/hlabmonitor

systemctl daemon-reload

echo ""
echo "========================================="
echo "HLabMonitor successfully installed!"
echo "========================================="
echo ""
echo "The application starts with the embedded default configuration."
echo ""
echo "To customize the configuration (optional):"
echo "  sudo cp /etc/hlabmonitor/application-override-example.yaml /etc/hlabmonitor/application.yaml"
echo "  sudo nano /etc/hlabmonitor/application.yaml"
echo "  sudo systemctl restart hlabmonitor"
echo ""
echo "Or via environment variables:"
echo "  sudo nano /etc/default/hlabmonitor"
echo ""
echo "Start the service:"
echo "  sudo systemctl start hlabmonitor"
echo "  sudo systemctl enable hlabmonitor"
echo ""
echo "View logs:"
echo "  sudo journalctl -u hlabmonitor -f"
echo ""

exit 0
